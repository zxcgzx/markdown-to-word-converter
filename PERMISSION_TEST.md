# 商业化权限系统测试指南

## 🎯 3级权限体系 (已优化)

### 1. 🆓 基础用户 (basic123)
- 每日转换限制：15次 ⬆️
- 文档大小限制：10000字符 ⬆️
- 支持基础Markdown语法
- ❌ 不支持数学公式

### 2. ⭐ 高级用户 (517517) 
- 每日转换限制：50次
- 文档大小限制：50000字符
- ✅ 支持数学公式
- ✅ 支持批量处理
- ✅ 自定义导出模板

### 3. 👑 超级管理员 (lingling)
- 无任何使用限制
- ✅ 所有功能
- ✅ 管理员后台面板
- ✅ 配额管理功能
- ✅ 密码生成器
- ✅ 使用统计查看

## 🛠️ 超级管理员后台功能

### 📊 配额管理
- 查看各用户类型的今日使用情况
- 重置单个用户类型的配额
- 一键重置所有用户配额
- **查看已生成的密码列表** (按用户类型分组显示)
- **密码管理操作** (复制、删除单个密码)
- **批量清除所有密码**

### 🔑 密码生成器
- 为基础用户/高级用户生成新密码
- 自定义密码长度 (6-20位)
- 一键复制生成的密码

### 📈 使用统计
- 今日各类用户预览生成次数统计 (实时预览内容变化时计数)
- 系统总体使用情况
- 清除历史统计数据

**📊 统计说明**：
- ✅ **实时预览生成** - 计入配额统计 (使用防抖机制，停止输入2秒后计数)
- ✅ **Word下载转换** - 基于预览生成，无额外配额消耗
- ❌ **复制富文本** - 不计入配额统计  
- ❌ **文件上传** - 不计入配额统计
- ❌ **示例加载** - 不计入配额统计 (4个示例)
- ❌ **草稿加载** - 不计入配额统计
- ❌ **清空内容** - 不计入配额统计

**🕐 防抖机制说明**：
- 用户输入时不会立即消耗配额
- 停止输入2秒后才计算一次配额
- 避免频繁输入导致配额快速耗尽
- 保证用户正常的编辑体验

## 🧪 测试步骤

1. **基础功能测试**
   - 使用 `basic123` 登录，测试15次预览生成限制 (修改内容后等待2秒，重复15次)
   - 测试10000字符文档大小限制
   - 验证数学公式被禁用
   - **防抖测试**：连续快速输入，确认配额不会快速消耗
   - **示例测试**：加载4个示例 (📄📊🚀📐)，确认不消耗配额
   - **操作测试**：文件上传、草稿加载、清空内容，确认不消耗配额

2. **高级用户测试**
   - 使用 `517517` 登录，测试50次预览生成配额 (修改内容后等待2秒，重复50次)
   - 测试50000字符文档支持
   - 验证数学公式功能可用
   - **防抖测试**：验证2秒防抖机制正常工作

3. **超级管理员测试**
   - 使用 `lingling` 登录，验证管理按钮出现
   - **测试配额管理功能**：
     - 查看各用户类型的使用情况
     - 查看已生成密码列表 (按类型分组)
     - 测试重置配额功能
   - **测试密码生成器** (重要：生成的密码现在可以实际使用！)
   - 验证自定义密码登录功能
   - **密码管理测试**：
     - 在两个标签页都能看到密码列表
     - 测试复制、删除功能
     - 验证批量清除功能
   - 查看使用统计数据

## ✅ 已实现功能

- ✅ 简化为3级用户权限分级
- ✅ 每日转换配额管理
- ✅ 文档大小限制检查
- ✅ 功能权限控制
- ✅ 用户状态显示界面
- ✅ 权限详情查看
- ✅ 升级引导提示（只推荐高级用户）
- ✅ 配额回滚机制
- ✅ **超级管理员后台面板**
- ✅ **配额管理功能**
- ✅ **可用密码生成器** (生成的密码现在可以实际登录！)
- ✅ **自定义密码管理** (支持查看、复制、删除生成的密码)
- ✅ **使用统计功能**
- ✅ **退出登录功能** (方便切换账号)

## 🎉 最新优化成果

1. **密码生成器修复** ✨
   - 生成的密码现在可以实际用于登录系统
   - 支持基础用户和高级用户密码生成
   - 密码列表管理：查看、复制、删除功能

2. **基础用户权限提升** 📈
   - 每日转换次数：5次 → 15次 (提升3倍)
   - 文档大小限制：5K → 10K字符 (提升2倍)
   - 更好的试用体验，维持升级价值

3. **退出登录功能** 🚪
   - 用户状态栏"退出"按钮
   - 快捷键支持：Ctrl+Q
   - 智能内容保存提醒
   - 完整的会话状态清理
   - **界面显示修复** (退出后正确显示密码输入界面)

## 💡 使用提示

**切换账号方法**：
1. 点击用户状态栏右侧的"退出"按钮
2. 或使用快捷键 `Ctrl+Q`
3. 确认退出后重新输入密码即可切换

系统已完成全面优化，支持实用的3级权限分级、完整的动态密码管理和便捷的账号切换功能！

## 🔧 最新修复 (2025-06-25)

### ✅ 解决跨设备密码同步问题
**问题**：电脑设备生成的密码在手机端无法登录
**原因**：密码存储在本地localStorage中，不同设备间无法同步
**解决方案**：
- ✅ 添加密码导出功能：可将密码导出为JSON文件
- ✅ 添加密码导入功能：在新设备上导入密码文件
- ✅ 添加二维码分享：快速传输密码到其他设备
- ✅ 位置：超级管理员面板 → 密码生成 → 跨设备同步

### ✅ 解决高级用户配额共用问题
**问题**：所有高级用户的限制次数是共用的，而不是每人独立
**原因**：配额Key只包含用户等级(advanced)，没有区分具体密码
**解决方案**：
- ✅ 修改配额Key生成逻辑：从`usage_advanced_date`改为`usage_[具体密码]_date`
- ✅ 每个生成的密码现在都有独立的50次配额
- ✅ 保持向后兼容：仍能统计旧数据
- ✅ 更新管理面板：显示修复状态提示

### 🧪 验证方法

#### 1. 🚀 超简单分享流程（推荐）

**设备A（生成密码）：**
1. 使用 `lingling` 登录超级管理员
2. 进入管理面板 → 密码生成标签页
3. 生成密码，点击"📱 复制分享码"
4. 分享码自动复制（格式：PWD:abc123|advanced|2025-01-01）
5. 通过微信/QQ发送给朋友

**设备B（接收密码）：**
1. 复制朋友发送的分享码
2. 在登录界面点击"📱 粘贴分享码"
3. 自动解析并导入密码，提示"✅ 导入成功！"
4. 密码自动填入登录框，直接登录

⏱️ **整个过程只需要10秒！**

#### 2. 📁 文件导入流程（批量场景）

**设备A（已有密码）：**
1. 使用 `lingling` 登录超级管理员
2. 进入管理面板 → 密码生成标签页
3. 点击"📤 导出密码"下载JSON文件

**设备B（新设备）：**
1. 在登录界面点击"📥 导入文件"
2. 选择JSON文件，系统提示"✅ 导入成功！"
3. 现在可以使用导入的密码正常登录了

#### 3. 🎯 多种分享方式对比

| 分享方式 | 适用场景 | 操作步骤 | 便捷程度 |
|---------|---------|---------|---------|
| 📱 分享码 | 日常朋友分享 | 复制文本 → 微信发送 → 粘贴导入 | ⭐⭐⭐⭐⭐ |
| 📱 二维码 | 面对面分享 | 生成二维码 → 复制文本 → 导入 | ⭐⭐⭐⭐ |
| 📁 文件导入 | 批量密码管理 | 导出文件 → 传输 → 导入文件 | ⭐⭐⭐ |

#### 4. 独立配额测试
1. 生成3个高级用户密码（如：abc123, def456, ghi789）
2. 分别用这3个密码登录，每个都应该有独立的50次配额
3. 用abc123转换10次，再用def456登录，应该还是50次配额（不是40次）

#### 5. 🔄 解决方案详解
**问题场景**：电脑生成密码 → 手机无法登录 → 无法访问管理面板 → 无法导入
**解决方案**：在登录界面直接提供导入功能，无需先登录

### 📊 技术实现细节
- 修改了`getUsageKey()`函数使用密码作为唯一标识
- 更新了`getSpecificUserUsage()`函数兼容新旧数据格式
- 在登录时保存当前使用的密码到sessionStorage
- 添加了密码导出/导入的完整功能集
- 实现了分享码格式解析：`PWD:密码|用户类型|日期`
- 支持自动剪贴板读取和手动输入分享码
- 保持了所有现有功能的正常运行

### 🎯 实际使用示例

**场景**：小明想把密码分享给朋友小红

**小明操作**：
```
1. 登录 lingling → 管理面板 → 密码生成
2. 生成高级用户密码：abc123def
3. 点击"📱 复制分享码"
4. 微信发送给小红：PWD:abc123def|advanced|2025-06-25
```

**小红操作**：
```
1. 复制微信中的分享码
2. 打开系统登录界面
3. 点击"📱 粘贴分享码"
4. 系统自动填入密码 abc123def
5. 按回车登录成功！
```

**结果**：🎉 10秒完成密码分享，比传统方式简单10倍！